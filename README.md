# Gazprom Neft - Bitum Materials: AI Chat Bot

## Телеграм ИИ-бот компании Газпромнефть Битумные Материалы

Инструкция по установке находится в [INSTALLATION.md](./INSTALLATION.md)

## Возможности пользователей
- Просмотр каталога продукции по категориям или сферам применения
- Получение подробной карточки продукта: Название, id продукта, сфера, категория, описание, премущества, информация по упаковке.
- Лексический и Семантический поиск для нахождения продуктов
- Спросить у AI - RAG система, позволяющая ответить на вопросы о продукте по документации (СТО, ГОСТы, ПБХП, разрешительные документы)
- Получение контактной информации
- Получение списка всех возможностей бота по `/help`
- По вопросам цен/остатков на складе происходит переадресация на Битум Стор

## Возможности администраторов

- Панель администратора по команде /admin
- Показать список активных продуктов 
- Добавить продукт
- Отредактировать карточку
- Удалить карточку
- Изменить главное фото продукта 
- Удалить главное фото продукта 
- Добавить файлы к определенному продукту 
- Удалить файлы у определенного продукта


# TODO:
0. ~~AI RAG System~~ **DONE**
1. ~~Создать автоответчик на поведение вне какого-либо контекста~~ **DONE**
2. ~~Улучшить поиск~~ **DONE**
3. ~~Согласоавить навигационную логику~~ **DONE**
4. ~~`delete_files.py` - пофиксить вывод после удаления файла~~ **DONE**
5. ~~Скачивание файлов: сейчас файлы качаются ручками, нет проверки на дозагрузку файлов, или удаление файлов. Нужно придумать как починить.~~ **DONE**
6. ~~Promt Engeneering~~ **DONE**
7. ~~Интегрировать таблицу product_package в карточку продукта~~ **DONE**
8. ~~Каскадное удаление файлов при удалении продукта~~ **DONE** 
9. ~~Переименовать названия продуктов по краткому наименованию из СТО~~ **DONE**
10. ~~Сделать переадресацию на Битум Стор по вопросам остатков/цен в промте~~ **DONE**
11. `__init__.py`
12. Создать `requirements.txt`
13. Оформить Docker
14. Название бота?

# FIXME:
1. ~~Названия продуктов в каталоге берутся из products, а в карточке продукта из product_spheres. В админ-панели редактируется поле в products. Что делать с полем product_spheres в этом случае? Может заменять и там и там?~~
> Теперь появилась функция `sync_product_name_to_spheres`, которая синхронизирует название из двух таблиц. А функция `update_product_field` обновляет поле в products и обновляет все остальные продукты в product_spheres
2. ~~Кнопка после удаления документа "Удалить еще файлы этого продукта" не работает~~
> Оказывается рекурсивно вызвать функцию удаления не сделает жизнь лучше 
3. ~~Убрать лишний вывод: множественные вызовы `.get_statistics()`~~ 
> Пофиксил вывод, теперь мусорных логов минимум + обновил системное сообщение в логах и телеграме
4. ~~Убрать инициализирующую загрзку документов~~
> Была проблема, поиск работал около 20 секунд, так как поиск инициализировался каждый раз заново. Была реализована оптимаизация, поиск ускорился в 10 раз.
5. ~~Изменить вывод информации от бота~~
6. ~~Добавить в "Помощь" новые реализации и изменить старые~~
7. ~~Ошибка дублирования ordering при загрузке файлов в админ панели~~
> Исправлена логика автоматического определения ordering в ProductFileRepository для избежания конфликтов уникального ключа ux_prod_kind_order
8. Embedding strategy
9. ~~Подумать как лучше расположить кнопки назад при отправке медиа и документации~~
> Вся логика навигации проверена, сейчас все устраивает
